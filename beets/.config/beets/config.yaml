# https://beets.readthedocs.io/en/stable/reference/config.html

directory: /data/audio/music/sorted
library: /data/audio/music/sorted/musiclibrary.db

per_disc_numbering: true

import:
  copy: true
  # move: true
  # autotag: false
  log: beetslog.txt

# match:
#   required: year

# custom fields:
#   - source: (for albumtype:Soundtrack)
#     The name of the source for the soundtrack,
#     e.g. the source of "Transistor Soundtrack" is "Transistor".
#   - sourcetype: (for albumtype:Soundtrack)
#     Type of the source.
#     One out of "Game", "Movie", "Anime".
#   - anime:
#     For singles in the context of anime releases.
#     Can be set to "Opening", "Ending", "Insert", etc.
#   - touhou:true
#     If it is a Touhou arrangement (disc).
#   - doujin:true
#     Released by a doujin circle (usually at some event).
#   - event:
#     Event at which the doujin CD was released,
#     e.g. "M3-41", "C-83", "Reitatsei-7".
#     Refer to https://vgmdb.net/db/events.php for a reference list.

# https://beets.readthedocs.io/en/stable/reference/pathformat.html
paths:
  # special stuff
  # TODO anime:true: '#touhou/$album%aunique{}/$disc_and_track - $title'
  doujin:true: "#%ifdef{touhou,touhou,doujin}\
    /$albumartist_or_label\
    /$long_date - $album%aunique{}%ifdef{event, [$event]}\
    /$disc_and_track - $title"
  # normal stuff
  albumtype:soundtrack: '#soundtrack/%if{source,$source/}$year - $album%aunique{}/$disc_and_track - $title'
  comp: $albumartist_or_label/$year - $album%aunique{}/$disc_and_track - $artist - $title
  singleton: $albumartist/$title
  # default: $artist/$title
  default: $albumartist/$year - $album%aunique{}/$disc_and_track - $title

album_fields:
  long_date: '"-".join(f"{n:02}" for n in [year, month, day] if n)'
  soundtrack_source: 'f"{source}/" if locals().get("source", None) and source != album else ""'

item_fields:
  disc_and_track:
    f"{disc}.{track:0{max(2, len(str(tracktotal)))}}"
    if disctotal > 1
    else f"{track:0{max(2, len(str(tracktotal)))}}"
  albumartist_or_label: label if comp and label else albumartist

# https://beets.readthedocs.io/en/latest/plugins/index.html
plugins: fetchart lastgenre missing duplicates inline
# chroma embedart convert ftintitle

lastgenre:
  count: 1
  # separator: "\x00"  # multi-field ID3v2.4 text tags are separated by nulls - http://id3.org/id3v2.4.0-frames section 4.2 | doesn't seem to work out that well?

# disabled, for now
# ftintitle:
#   format: (feat. {0})

# chroma:
#   auto: false
